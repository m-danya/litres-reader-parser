# Парсер списка книг для озвучки
ЛитРес позволяет любому желающему записывать аудиокниги для их сайта. 
На выбор даётся огромное количество книг (в том числе сомнительного качества), поэтому нужно тщательно выбирать книгу для озвучки.
Я написал этот скрипт, чтобы самостоятельно отсортировать список книг для последующего выбора интересной и популярной книги для озвучки. 

Скрипт состоит из двух частей: сбор списка доступных книг с помощью Selenium и получение информации о книгах с помощью requests + bs4 с сайта ЛитРес. Работа второй части занимает несколько часов при разумном таймауте. Скрипт устойчив к большому количеству ошибок вроде отсутствия какой-то информации о конкретной книге на сайте и разных кодах ответа HTTP. Поскольку процесс парсинга долгий, а ошибок может произойти огромное количество, **программа сохраняет результаты своей работы при любых возникших ошибках** в pickle-файлы. Также она умеет стартовать с некоторого индекса в списке книг. Таким образом, при возникновении ошибки в процессе парсинга полученные данные не пропадут, и **можно продолжить парсинг с того места, где скрипт упал**. Поскольку список доступных для озвучивания книг может меняться, для продолжения работы программы нужно использовать не только аргумент `--start-with`, но и аргумент `--cached`, чтобы использовать сгенерированный на первом этапе прошлого запуска pickled список с доступными книгами, а не составлять его заново.


Опционально сообщения о результатах парсинга для оперативности могут отсылаться в Telegram с помощью удобного телеграм-бота [Alarmer](https://t.me/alarmer_bot). Чтобы воспользоваться этой функцией, нужно поместить в файл `ALARMER_API_KEY.txt` API-ключ, который можно получить у бота.

Список собираемых свойств:
- автор и название
- количество страниц
- средний рейтинг
- количество оценок
- ссылка
- дата публикации на сервисе

### Добросовестность парсинга
Программа обращается к серверам ЛитРес один раз для каждой доступной книги с разумным таймаутом (по умолчанию -- 10 секунд между обращенями), что равноценно тому, что человек вручную просмотрит все доступные ему для озвучки книги, поэтому программа не создает хоть сколько-нибудь значимой нагрузки на сервис. К тому же, аргумент `--limit` позволяет ограничить число рассматриваемых книг, а аргумент `--start-with` позволяет не запрашивать ранее полученную информацию при повторном запуске. 

### Пример работы

```
RESULT: 472 books were parsed                                                                                          
Top-25 books:                                                                                                          
{'author': 'Михаил Булгаков', 'title': 'Пропавший глаз', 'pages': 16, 'mean_rating': 4.7, 'n_votes': 9778, 'link': 'htt
ps://www.litres.ru/mihail-bulgakov/propavshiy-glaz/', 'published': '04 ноября 2008'}                                   
{'author': 'Михаил Булгаков', 'title': 'Полотенце с петухом', 'pages': 15, 'mean_rating': 4.8, 'n_votes': 8062, 'link':
 'https://www.litres.ru/mihail-bulgakov/polotence-s-petuhom/', 'published': '04 ноября 2008'}                          
{'author': 'Михаил Булгаков', 'title': 'Звёздная сыпь', 'pages': 16, 'mean_rating': 4.8, 'n_votes': 7902, 'link': 'http
s://www.litres.ru/mihail-bulgakov/zvezdnaya-syp/', 'published': '04 ноября 2008'}                                      
{'author': 'Михаил Булгаков', 'title': 'Стальное горло', 'pages': 10, 'mean_rating': 4.8, 'n_votes': 6862, 'link': 'htt
ps://www.litres.ru/mihail-bulgakov/stalnoe-gorlo/', 'published': '04 ноября 2008'}                                     
{'author': 'Александр Островский', 'title': 'Гроза', 'pages': 60, 'mean_rating': 4.6, 'n_votes': 5975, 'link': 'https:/
/www.litres.ru/aleksandr-ostrovskiy/groza-172629/', 'published': '14 ноября 2008'}
{'author': 'Михаил Булгаков', 'title': 'Крещение поворотом', 'pages': 11, 'mean_rating': 4.8, 'n_votes': 5330, 'link': 
'https://www.litres.ru/mihail-bulgakov/kreschenie-povorotom/', 'published': '04 ноября 2008'}
{'author': 'Александр Пушкин', 'title': 'Дубровский', 'pages': 90, 'mean_rating': 4.6, 'n_votes': 4420, 'link': 'https:
//www.litres.ru/aleksandr-pushkin/dubrovskiy/', 'published': '04 ноября 2008'}
{'author': 'Николай Гоголь', 'title': 'Ревизор', 'pages': 90, 'mean_rating': 4.7, 'n_votes': 2373, 'link': 'https://www
.litres.ru/nikolay-gogol/revizor-173499/', 'published': '20 ноября 2008'}
<...>
```

### Требования
- chromedriver (для Selenium для первой части скрипта)
- Python 3.9 (на меньших версиях не работает)
- библиотеки для Python:
```bash
pip install -r requirements.txt
```

### Запуск
Запуск скрипта возможен в двух режимах: с чистого листа (`--no-cached`) и с использованием уже готового списка книг (собранного ранее в режиме "с чистого листа" этим скриптом, `--cached`)

Пример команды для запуска:
```bash
vim SECRET_LINK.txt # авторизирующая в литрес.чтец ссылка
vim ALARMER_API_KEY.txt # необязательно: API-ключ для уведомлений в телеграм
python main.py --no-cached --timeout 5 > output.txt 
```

Если Вы вдруг собираетесь использовать этот скрипт, можете написать мне, расскажу детали
