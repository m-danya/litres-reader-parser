# Парсер списка книг для озвучки
ЛитРес позволяет любому желающему записывать аудиокниги для их сайта. 
На выбор даётся огромное количество книг (в том числе сомнительного качества), поэтому нужно тщательно выбирать книгу для озвучки.
Я написал эти скрипты, чтобы самостоятельно отсортировать список книг для последующего выбора интересной и популярной книги для озвучки. 

Скрипт для сбора списка книг состоит из двух частей: сбор списка доступных книг с помощью Selenium и получение информации о книгах с помощью requests + bs4 с сайта ЛитРес. Работа второй части занимает несколько часов при разумном таймауте. Скрипт устойчив к большому количеству ошибок вроде отсутствия какой-то информации о конкретной книге на сайте и разных кодах ответа HTTP. Поскольку процесс парсинга долгий, а ошибок может произойти огромное количество, **программа сохраняет результаты своей работы при любых возникших ошибках** в pickle-файлы. Также она умеет стартовать с некоторого индекса в списке книг. Таким образом, при возникновении ошибки в процессе парсинга полученные данные не пропадут, и **можно продолжить парсинг с того места, где скрипт упал**. Поскольку список доступных для озвучивания книг может меняться, для продолжения работы программы нужно использовать не только аргумент `--start-with`, но и аргумент `--cached`, чтобы использовать сгенерированный на первом этапе прошлого запуска pickled список с доступными книгами, а не составлять его заново.

Опционально сообщения о результатах парсинга для оперативности могут отсылаться в Telegram с помощью удобного телеграм-бота [Alarmer](https://t.me/alarmer_bot). Чтобы воспользоваться этой функцией, нужно поместить в файл `ALARMER_API_KEY.txt` API-ключ, который можно получить у бота.

Список собираемых свойств:
- автор и название
- количество страниц
- средний рейтинг
- количество оценок
- ссылка
- дата публикации на сервисе
- есть ли аудиокнига

Скрипт `show_best.py` предназначен для фильтрации списка книг по заданным критериям:
- можно убрать из списка книги, у которых уже есть аудиокнига
- можно убрать из списка авторов, чьи книги Вы точно не захотите озвучивать
- можно убрать книги с количеством страниц, больше заданного
- сортировка производится по количеству голосов за книгу

Вывод оформлен в виде красивой таблицы с помощью библиотеки `tabulate`.


### Добросовестность парсинга
Программа обращается к серверам ЛитРес один раз для каждой доступной книги с разумным таймаутом (по умолчанию -- 120 секунд между обращенями), что равноценно тому, что человек вручную просмотрит все доступные ему для озвучки книги, поэтому программа не создает хоть сколько-нибудь значимой нагрузки на сервис. К тому же, аргумент `--limit` позволяет ограничить число рассматриваемых книг, а аргумент `--start-with` позволяет не запрашивать ранее полученную информацию при повторном запуске. 

### Пример работы

```
2963 books were chosen from 4160 to meet the criteria.

author                title                   pages    mean_rating    n_votes  link                                                                                                         published         has_audiobook
--------------------  --------------------  -------  -------------  ---------  -----------------------------------------------------------------------------------------------------------  ----------------  ---------------
Наталья Сапункова     Шут и слово короля        520            4.7        566  https://www.litres.ru/natalya-sapunkova-23377987/shut-i-slovo-korolya/                                       14 мая 2020       False
:Алина Суворова, ...  Силы есть. Истори...      100            4.5        449  https://www.litres.ru/aleksandr-gorohov-14826286/sily-est-istorii-ludey-pobedivshih-rak/                     20 апреля 2018    False
Александр Островский  Свои люди – сочтемся       70            4.4        365  http://www.litres.ru/aleksandr-ostrovskiy/dohodnoe-mesto-svoi-ludi-sochtemsya-bednost-ne-porok-les/172621/   14 ноября 2008    False
Алексей Толстой       Упырь                      90            4.6        254  https://www.litres.ru/aleksey-tolstoy/upyr/                                                                  21 ноября 2008    False
<...>
```

### Требования
- chromedriver (для Selenium для первой части скрипта)
- Python 3.9 (на меньших версиях не работает)
- библиотеки для Python:
```bash
pip install -r requirements.txt
```

### Запуск
Запуск скрипта для парсинга возможен в двух режимах: с чистого листа (`--no-cached`) и с использованием уже готового списка книг (собранного ранее в режиме "с чистого листа" этим скриптом, `--cached`)

Пример команды для запуска парсинга и последующей сортировки книг:
```bash
vim SECRET_LINK.txt # авторизирующая в литрес.чтец ссылка
vim ALARMER_API_KEY.txt # необязательно: API-ключ для уведомлений в телеграм
python main.py --no-cached --timeout 120 > output.txt 
# after a long time
python show_best.py -d output --only-without-audiobook --skip-unwanted-authors authors.txt
```

Если Вы вдруг собираетесь использовать этот скрипт, можете написать мне, расскажу детали
